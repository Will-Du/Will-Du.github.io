---
title: 数据库读写分离
date: 2019-05-16 14:19:43
tags: sql
---
<label style="color:red">1.主数据库创建一个用户(尽量不要使用root) </label>
	CREATE USER 'username'@'%' IDENTIFIED BY 'password';
	username:用户名
	%：指定该用户在哪个主机上可以登陆，如果是本地用户可用localhost，如果想让该用户可以从任意远程主机登陆，可以使用通配符%
	password:用户密码
<label style="color:red">2.给该用户授权slave(mysql8.0以上可以不用写IDENTIFIED BY 'password';)</label>
	GRANT REPLICATION SLAVE ON \*.\* to 'username'@'%';
<label style="color:red">3.主数据库与从数据库修改配置文件(linux:my.cnf;window:my.ini)并重启数据库</label>
	log-bin=mysql-bin //启用二进制日志 (主数据库必须)
	server-id=1 //服务器唯一ID，默认是1，一般取IP最后一段(必须)(不同服务器的server-id应不同)<!-- more -->
<label style="color:red">4.登录主服务器的mysql，查询master的状态(执行完此步骤后不要再操作主服务器MYSQL，防止主服务器状态值变化)</label>
	show master status;
```java
File			Position		Binlog_Do_DB		Binlog_Ignore_DB
mysql-bin.000004	308
```
<label style="color:red">5.配置从服务器Slave</label>
	change master to master_host='主数据库ip',master_user='username',master_password='password', master_log_file='mysql-bin.000004',master_log_pos=308; 
 	username：主数据库创建的用户名
	password：主数据库创建的用户的密码
	master_log_file：主数据库的状态的File
	master_log_pos：主数据库的状态的Position
<label style="color:red">6.start slave; //启动从服务器复制功能</label>
<label style="color:red">7.检查从服务器复制功能状态</label>
*************************** row ***************************
			 Slave_IO_State: Waiting for master to send event
					Master_Host: 10.20.14.6(主数据库ip)
					Master_User: repl(用户名)
					Master_Port: 3306
				Connect_Retry: 60
			Master_Log_File: mysql-bin.000004
	Read_Master_Log_Pos: 308
		 Slave_IO_Running: Yes(数据同步)
		Slave_SQL_Running: Yes(sql同步)
<label style="color:red">8.测试，在主数据添加一条数据，在从数据库查询</label>

